<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ðŸ“Š KAMLAC Dashboard - Suivi des Ventes</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        /* (Votre CSS existant) */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            overflow-x: hidden;
            min-height: 100vh;
        }
        .dashboard-container {
            min-height: 100vh;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
        }
        /* (Le reste de votre CSS) */
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- (Votre HTML existant) -->
    </div>

    <script>
        // Configuration Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBuR-B_bOyMtNn1xnSQCCsxfJWydzg9mvs",
            authDomain: "kamlac-dashboard.firebaseapp.com",
            projectId: "kamlac-dashboard",
            storageBucket: "kamlac-dashboard.firebasestorage.app",
            messagingSenderId: "220610836736",
            appId: "1:220610836736:web:1a1cee05aef8066a725be5",
            measurementId: "G-Q8DKW4YL0L"
        };

        // Variables globales
        let salesData = [];
        let filteredData = [];
        let charts = {};
        let salesDetailOffset = 0;
        const salesDetailLimit = 50;
        let db;
        let isFirebaseInitialized = false;

        // Initialiser Firebase
        function initializeFirebase() {
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                isFirebaseInitialized = true;
                console.log("Firebase initialisÃ© avec succÃ¨s");
                setupRealtimeListener();
            } catch (error) {
                console.error("Erreur d'initialisation Firebase:", error);
            }
        }

        // Ã‰couteur en temps rÃ©el pour la collection 'sales'
        function setupRealtimeListener() {
            db.collection("sales").onSnapshot((querySnapshot) => {
                const updatedSalesData = [];
                querySnapshot.forEach((doc) => {
                    updatedSalesData.push({ id: doc.id, ...doc.data() });
                });
                salesData = updatedSalesData;
                saveToLocalStorage();
                populateFilters();
                applyFilters();
                updateDataTable();
                updateDataStats();
            });
        }

        // Initialisation de l'application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            initializeFirebase(); // Initialiser Firebase au dÃ©marrage
        });

        function initializeApp() {
            console.log('Initialisation de l\'application...');
            setDefaultDates();
            updateLastUpdateTime();
            loadFromLocalStorage();
            populateFilters();
            applyFilters();
            updateDataTable();
            updateDataStats();
            setTodayForNewSale();
        }

        // (Le reste de vos fonctions JavaScript)
    </script>
</body>
</html>
